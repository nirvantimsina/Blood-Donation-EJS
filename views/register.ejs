<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register | Blood Donor Nepal</title>
    <link rel="icon" type="image/svg+xml" href="/images/blood-donor.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a209b08554.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/css/login-register.css">
</head>

<body>
    <% if (message || error) { %>
        <div class="toast position-fixed <% if (message) { %> bg-success <% } else if (error) { %> bg-danger <% } %>"
            id="toast-message" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">
                    <% if (message) { %>
                        <i class="fa-solid fa-circle-check fa-sm" style="color: #f0f0f0;"></i>
                        <%= message %>
                            <% } else if (error) { %>
                                <i class="fa-solid fa-triangle-exclamation fa-sm" style="color: #f0f0f0;"></i>
                                <%= error %>
                                    <% } %>
                </div>
                <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"
                    style="color: white;"></button>
            </div>
        </div>
        <% } else { } %>
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="custom-header d-flex align-items-center justify-content-center">
                            <a href="/" style="text-decoration: none;"><img src="../images/blood-donor.png"
                                    alt="Blood Donation Logo" class="me-2">
                                <h1 class="m-0">Blood Donor Nepal</h1>
                            </a>
                        </div>
                        <form class="custom-form" id="registrationForm" method="POST" novalidate>
                            <h2 class="form-title">New Registration</h2>
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="firstName" class="form-label">First Name</label>
                                    <input type="text" class="form-control" id="firstName" name="firstName" required
                                        pattern="[A-Za-z]+">
                                    <div class="invalid-feedback" id="firstNameRequired">Valid First name is required.
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label for="middleName" class="form-label">Middle Name</label>
                                    <input type="text" class="form-control" id="middleName" name="middleName">
                                </div>
                                <div class="col-md-4">
                                    <label for="lastName" class="form-label">Last Name</label>
                                    <input type="text" class="form-control" id="lastName" name="lastName" required
                                        pattern="[A-Za-z]+">
                                    <div class="invalid-feedback" id="lastNameRequired">Valid Last name required.</div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="address" class="form-label">Address</label>
                                <select class="form-select" id="province" name="province" required>
                                    <option value="" selected disabled>Select Province</option>
                                </select>
                                <select class="form-select mt-3" id="district" name="district" required>
                                    <option value="" selected disabled>Select District</option>
                                </select>
                                <div class="invalid-feedback">Address is required.</div>
                                <div class="col-md-6 mt-3">
                                    <label for="city" class="form-label">City</label>
                                    <input type="text" class="form-control" id="city" name="city"
                                        placeholder="Enter your city" required>
                                    <div class="invalid-feedback">City is required.</div>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-2">
                                    <label for="gender">Gender:</label><br>
                                </div>
                                <div class="col-md-8">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="gender" id="male"
                                            value="male" required>
                                        <label class="form-check-label" for="male">Male</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="gender" id="female"
                                            value="female">
                                        <label class="form-check-label" for="female">Female</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="gender" id="other"
                                            value="other">
                                        <label class="form-check-label" for="other">Others</label>
                                        <div class="invalid-feedback">Please select your gender.</div>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="lastDonationDate" class="form-label">Last Donation Date</label>
                                <input type="date" class="form-control" id="lastDonationDate" name="lastDonationDate">
                                <div class="form-text">If you haven't donated blood before, you can leave this blank.
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="contactNumber" class="form-label">Contact Number</label>
                                    <input type="text" class="form-control" id="contactNumber" name="contactNumber"
                                        required pattern="[0-9]{10}">
                                    <div class="invalid-feedback">valid 10-digit contact number is required.</div>
                                </div>
                                <div class="col-md-6">
                                    <label for="email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="email" name="email" required>
                                    <div class="invalid-feedback">Valid email is required.</div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">Password</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="password" name="password"
                                        pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z\d]).{6,}" required>
                                    <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                        <i class="fa-solid fa-eye fa-sm" style="color: #000000;" id="eyeIcon"></i>
                                    </button>
                                    <div class="invalid-feedback">
                                        <div>Password must:</div>
                                        <div>- Be at least 6 characters long.</div>
                                        <div>- Contain at least one number.</div>
                                        <div>- Contain at least one uppercase letter.</div>
                                        <div>- Contain at least one lowercase letter.</div>
                                        <div>- Contain at least one unique character.</div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-3">

                                <!-- this thing doesn't work I just added it for nothig, pls fix it -Nirvan-->
                                <div class="col-md-6">
                                    <label for="userImageInput" class="form-label">Upload Your Profile Picture</label>
                                    <input type="file" id="userImage" name="userImage" accept="image/*">
                                    <div class="invalid-feedback">Valid profile picture is required.</div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Register</button><br><br>
                            <label class="form-check-label">Already Registered? <a href="/login">Login here</a></label>
                        </form>
                    </div>
                </div>
            </div>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
            <script>
                //form validation
                function initializeFormValidation(formId) {
                    const form = document.getElementById(formId);
                    form.addEventListener('submit', function (event) {
                        if (!form.checkValidity()) {
                            event.preventDefault();
                        }

                        form.classList.add('was-validated');
                    });
                }

                //toast popup
                document.addEventListener('DOMContentLoaded', function () {
                    var toastElList = [].slice.call(document.querySelectorAll('.toast'))
                    var toastList = toastElList.map(function (toastEl) {
                        return new bootstrap.Toast(toastEl)
                    });
                    toastList.forEach(toast => toast.show());
                });


                //eye password script

                const passwordInput = document.getElementById("password");
                const togglePasswordButton = document.getElementById("togglePassword");
                const eyeIcon = document.getElementById("eyeIcon");

                togglePasswordButton.addEventListener("click", function () {
                    const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
                    passwordInput.setAttribute("type", type);
                    if (type === "password") {
                        eyeIcon.classList.remove("fa-eye-slash");
                        eyeIcon.classList.add("fa-eye");
                    } else {
                        eyeIcon.classList.remove("fa-eye");
                        eyeIcon.classList.add("fa-eye-slash");
                    }
                });


                //dynamic selection option for province and district

                const provinces = ["Koshi Province", "Madhesh Province", "Bagmati Province", "Gandaki Province", "Lumbini Province", "Karnali Province", "Sudur-Paschim Province"];

                const districts = {
                    "Koshi Province": ["Taplejung", "Sankhuwasabha", "Solukhumbu", "Udayapur", "Morang", "Ilam", "Jhapa", "Khotang", "Bhojpur", "Sunsari", "Panchthar", "Okhaldhunga", "Dhankuta", "Tehrathum"],
                    "Madhesh Province": ["Mahottari", "Rautahat", "Dhanusha", "Siraha", "Bara", "Sarlahi", "Parsa", "Saptari"],
                    "Bagmati Province": ["Bhaktapur", "Lalitpur", "Kathmandu", "Nuwakot", "Kavrepalanchok", "Rasuwa", "Ramechhap", "Dhading", "Dolakha", "Chitwan", "Makwanpur", "Sindhuli", "Sindhupalchok"],
                    "Gandaki Province": ["Parbat", "Nawalparasi (East of Bardaghat Susta)", "Syangja", "Tanahun", "Lamjung", "Baglung", "Kaski", "Manang", "Myagdi", "Mustang", "Gorkha"],
                    "Lumbini Province": ["Nawalparasi (West of Bardaghat Susta)", "Gulmi", "Eastern Rukum", "Arghakhanchi", "Pyuthan", "Rupandehi", "Palpa", "Kapilvastu", "Rolpa", "Bardiya", "Banke", "Dang"],
                    "Karnali Province": ["Western Rukum", "Salyan", "Dailekh", "Kalikot", "Jajarkot", "Surkhet", "Jumla", "Mugu", "Humla", "Dolpa"],
                    "Sudur-Paschim Province": ["Baitadi", "Dadeldhura", "Kanchanpur", "Achham", "Doti", "Bajura", "Darchula", "Kailali", "Bajhang"]
                };

                function populateOptions(selectElement, options) {
                    selectElement.innerHTML = "";
                    if (selectElement.id === "province") {
                        const defaultOption = document.createElement("option");
                        defaultOption.value = "";
                        defaultOption.textContent = "Select Province";
                        selectElement.appendChild(defaultOption);
                    }
                    options.forEach(option => {
                        const optionElement = document.createElement("option");
                        optionElement.value = option;
                        optionElement.textContent = option;
                        selectElement.appendChild(optionElement);
                    });
                }

                function handleProvinceChange() {
                    const provinceSelect = document.getElementById("province");
                    const districtSelect = document.getElementById("district");
                    const selectedProvince = provinceSelect.value;
                    if (selectedProvince && districts[selectedProvince]) {
                        districtSelect.innerHTML = "";
                        populateOptions(districtSelect, districts[selectedProvince]);
                    } else {
                        districtSelect.innerHTML = "<option value='' selected disabled>Select District</option>";
                    }
                }

                const provinceSelect = document.getElementById("province");
                populateOptions(provinceSelect, provinces);
                handleProvinceChange();

                provinceSelect.addEventListener("change", handleProvinceChange);


                // Initialize functions for both registration and login forms
                initializeFormValidation('registrationForm');
                //validate first and last name for numberical inputs
                function validateName(input, requiredError, invalidName) {
                    const nameInput = document.getElementById(input);
                    const firstName = nameInput.value.trim();
                    const nameRequiredError = document.getElementById(requiredError);
                    const invalidNameError = document.getElementById(invalidName);

                    if (firstName === "") {
                        nameRequiredError.style.display = "block";
                        invalidNameError.style.display = "none";
                    } else if (/[\d]/.test(firstName)) {
                        nameRequiredError.style.display = "none";
                        invalidNameError.style.display = "block";
                    } else {
                        nameRequiredError.style.display = "none";
                        invalidNameError.style.display = "none";
                    }
                }
                validateName("firstname", "firstNameRequired", "invalidFirstName");
                // Validate email field
                function validateEmail() {
                    const emailInput = document.getElementById("email");
                    const email = emailInput.value.trim();
                    const emailError = document.getElementById("emailError");

                    if (email === "") {
                        emailError.style.display = "block";
                    } else if (!isValidEmail(email)) {
                        emailError.style.display = "block";
                    } else {
                        emailError.style.display = "none";
                    }
                }

                // Validate password field
                function validatePassword() {
                    const passwordInput = document.getElementById("password");
                    const password = passwordInput.value.trim();
                    const passwordError = document.getElementById("passwordError");

                    if (password === "") {
                        passwordError.style.display = "block";
                    } else if (!isValidPassword(password)) {
                        passwordError.style.display = "block";
                    } else {
                        passwordError.style.display = "none";
                    }
                }

                // Validate contact number field
                function validateContactNumber() {
                    const contactNumberInput = document.getElementById("contactNumber");
                    const contactNumber = contactNumberInput.value.trim();
                    const contactNumberError = document.getElementById("contactNumberError");

                    if (contactNumber === "") {
                        contactNumberError.style.display = "block";
                    } else if (!isValidContactNumber(contactNumber)) {
                        contactNumberError.style.display = "block";
                    } else {
                        contactNumberError.style.display = "none";
                    }
                }

                // Add event listeners for input fields
                document.getElementById("email").addEventListener("input", validateEmail);
                document.getElementById("password").addEventListener("input", validatePassword);
                document.getElementById("contactNumber").addEventListener("input", validateContactNumber);

            </script>
</body>

</html>